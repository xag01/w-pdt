<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pomodoro</title>
<style>
body {
    font-family: system-ui, sans-serif;
    text-align: center;
    margin-top: 100px;
}

#timer {
    font-size: 64px;
    margin: 20px;
}

button {
    padding: 10px 20px;
    margin: 5px;
    font-size: 16px;
}
</style>
</head>
<body>

<h1 id="mode">Work</h1>
<div id="timer">25:00</div>

<div>
    <button onclick="startTimer()">Start</button>
    <button onclick="pauseTimer()">Pause</button>
    <button onclick="resetTimer()">Reset</button>
</div>

<div style="margin-top:30px;">
    Work (min): <input id="workInput" type="number" min="1" value="25">
    Break (min): <input id="breakInput" type="number" min="1" value="5">
    <button onclick="saveSettings()">Save</button>
</div>

<script>
let timer;
let timeRemaining;
let isRunning = false;
let isWorkMode = true;

const timerDisplay = document.getElementById("timer");
const modeDisplay = document.getElementById("mode");

function loadSettings() {
    const work = localStorage.getItem("workDuration");
    const brk = localStorage.getItem("breakDuration");

    document.getElementById("workInput").value = work || 25;
    document.getElementById("breakInput").value = brk || 5;

    setInitialTime();
}

function saveSettings() {
    localStorage.setItem("workDuration", document.getElementById("workInput").value);
    localStorage.setItem("breakDuration", document.getElementById("breakInput").value);
    setInitialTime();
}

function setInitialTime() {
    const work = parseInt(document.getElementById("workInput").value);
    const brk = parseInt(document.getElementById("breakInput").value);

    timeRemaining = (isWorkMode ? work : brk) * 60;
    updateDisplay();
}

function updateDisplay() {
    const minutes = Math.floor(timeRemaining / 60);
    const seconds = timeRemaining % 60;
    timerDisplay.textContent =
        `${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}`;
}

function startTimer() {
    if (isRunning) return;
    isRunning = true;

    timer = setInterval(() => {
        if (timeRemaining > 0) {
            timeRemaining--;
            updateDisplay();
        } else {
            switchMode();
        }
    }, 1000);
}

function pauseTimer() {
    isRunning = false;
    clearInterval(timer);
}

function resetTimer() {
    pauseTimer();
    setInitialTime();
}

function switchMode() {
    pauseTimer();
    isWorkMode = !isWorkMode;
    modeDisplay.textContent = isWorkMode ? "Work" : "Break";
    setInitialTime();
    notifyUser();
}

function notifyUser() {
    if (Notification.permission === "granted") {
        new Notification(isWorkMode ? "Back to Work!" : "Time for a Break!");
    }
}

if ("Notification" in window) {
    Notification.requestPermission();
}

loadSettings();
</script>

</body>
</html>
